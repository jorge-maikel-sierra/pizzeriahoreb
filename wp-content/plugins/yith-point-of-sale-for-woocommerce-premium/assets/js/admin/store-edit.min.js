!function(s){var r=s("#yith-pos-store"),o=s("body").hasClass("yith-pos-store-wizard"),t=yith_pos_store_edit.post_id;o||s(document).on("submit","body.post-type-yith-pos-store form#post",function(e){s(document).trigger("yith-pos-registers-list:deleteRegisterToCreate");var t,i=s(e.target).find("input,select,textarea").filter(":not(.yith-pos-create-user-form__field)");i.trigger("validate_field"),(t=i.filter(".invalid")).length&&(t=(i=t.first()).closest(".tabs-panel").attr("id"),(t=r.find("ul.metaboxes-tabs li a[href=#"+t+"]"))&&t.click(),i.focus(),e.preventDefault())});var e,i,n={dom:{list:s("#yith-pos-store-metabox-registers-list"),newBtn:s("#yith-pos-store-metabox-registers-list__new"),createFormWrapper:s("#yith-pos-store-metabox-registers-list__create-form-wrapper")},init:function(){n.dom.newBtn.on("click",n.newRegisterFormHandler),n.dom.createFormWrapper.on("click",".yith-pos-register-create",n.create),n.dom.list.on("click",".yith-pos-register-update",n.update),n.dom.list.on("click",".yith-pos-register-delete",n.deleteRegister),s(document).on("yith-pos-registers-list:deleteRegisterToCreate",n.deleteRegisterToCreate),s(document).on("click",".yith-pos-register-payment-methods input[type=checkbox]",n.atLeastOnePaymentMethod),s(document).on("change keyup",".yith-pos-store-register__name-field-container",n.realtimeTitleEditing)},atLeastOnePaymentMethod:function(e){e=s(e.target);e.closest(".yith-pos-register-payment-methods").find("input[type=checkbox]:checked").length||e.prop("checked",!0)},getRegisterToCreate:function(){var e=n.dom.createFormWrapper.find(".yith-pos-store-register").first();return!!e.length&&e},deleteRegisterToCreate:function(){n.dom.createFormWrapper.find(".yith-pos-store-register").remove()},initFields:function(){s(document.body).trigger("wc-enhanced-select-init").trigger("yith-framework-enhanced-select-init").trigger("yith-plugin-fw-metabox-init-deps")},newRegisterFormHandler:function(e){e.preventDefault(),n.dom.newBtn.is(".closed")?n.closeForm():n.openForm()},openForm:function(){var e,t,i,r=n.getRegisterToCreate();r||(e=n.dom.newBtn.data("template"),(r=s(e)).hide(),n.dom.createFormWrapper.append(r),n.initFields(),o&&(t=r.find(".show-cashiers-list select"),s("#_cashiers option").each(function(){i=new Option(s(this).html().replace("&amp;ndash;","-"),s(this).val(),!1,!1),t.append(i)}),t.trigger("change"))),r.slideDown(),n.dom.newBtn.html(n.dom.newBtn.data("close-text")).addClass("closed")},closeForm:function(){var e=n.getRegisterToCreate();e&&e.slideUp(),n.dom.newBtn.html(n.dom.newBtn.data("text")).removeClass("closed")},serializeObject:function(e,t){var i={},r=e.serializeArray(),e=s.map(e.filter("input[type='checkbox'].on_off:not(:checked)"),function(e){return{name:s(e).attr("name"),value:s(e).val()}}),r=r.concat(e);return s.each(r,function(){var e=this.name;e&&t&&(e=e.replace(t,"")),i[e]?(i[e].push||(i[e]=[i[e]]),i[e].push(this.value||"")):i[e]=this.value||""}),i},getRegisterData:function(e){var t=e.find("input,select,textarea"),e=e.data("field-name-prefix");return t.trigger("validate_field"),n.serializeObject(t,e)},addMessage:function(e,t,i){t=s("<div class='yith-pos-admin-notice yith-pos-admin-notice--"+i+"'>"+t+"<span class='yith-pos-admin-notice__dismiss'></span></div>");e.find(".yith-pos-settings-box__content").prepend(t),yith_pos.scrollTo(e)},removeMessages:function(e){e.find(".yith-pos-admin-notice").remove()},create:function(){var e,i=n.getRegisterToCreate();i&&(n.removeMessages(i),e=n.getRegisterData(i),i.find(".validate-error").length||(i.block(yith_pos.blockParams),e.action="yith_pos_create_register",e.store_id=t,e.security=yith_pos_store_edit.create_register_nonce,s.ajax({type:"POST",data:e,url:ajaxurl,success:function(e){var t;"undefined"!=typeof e.success&&e.success?(t=s(e.register_html),n.dom.list.append(t),n.initFields(),n.deleteRegisterToCreate(),n.closeForm(),s(document).trigger("yith_pos_register_created",[t])):"undefined"!=typeof e.error&&n.addMessage(i,e.error,"error")},complete:function(){i.unblock(),s(document).find(".yith-pos-admin-notice").remove()}})))},update:function(e){var t=s(e.target).closest(".yith-pos-store-register");t&&(n.removeMessages(t),(e=n.getRegisterData(t)).id=t.data("register-id"),t.find(".validate-error").length||(t.block(yith_pos.blockParams),e.action="yith_pos_update_register",e.security=yith_pos_store_edit.update_register_nonce,s.ajax({type:"POST",data:e,url:ajaxurl,success:function(e){"undefined"!=typeof e.success&&e.success&&"undefined"!=typeof e.message&&n.addMessage(t,e.message,"success"),"undefined"!=typeof e.error&&n.addMessage(t,e.error,"error")},complete:function(){t.unblock()}})))},deleteRegister:function(e){var t=s(e.target).closest(".yith-pos-store-register");t&&n.removeMessages(t),t&&window.confirm(yith_pos_store_edit.i18n_register_delete_confirmation)&&(e={id:t.data("register-id"),action:"yith_pos_delete_register",security:yith_pos_store_edit.delete_register_nonce},t.block(yith_pos.blockParams),s.ajax({type:"POST",data:e,url:ajaxurl,success:function(e){"undefined"!=typeof e.success&&e.success?(t.unblock(),t.slideUp(400,function(){t.remove()})):"undefined"!=typeof e.error&&n.addMessage(t,e.error,"error")},complete:function(){t.unblock()}}))},realtimeTitleEditing:function(e){var t=s(e.target),e=t.closest(".yith-pos-store-register").find(".yith-pos-settings-box__header .yith-pos-settings-box__title").first();e.length&&e.html(t.val())}};n.init(),s(document).on("change",".yith-pos-store-register .on_off, .yith-pos-store-register [type=checkbox]",function(){var e=s(this),t=e.attr("id"),t=s(document).find("[data-dep-id="+t+"]");void 0!==t&&e.is(":checked")?s(t).css({opacity:1}):s(t).css({opacity:.3})}),s(document).find(".yith-pos-store-register .on_off, .yith-pos-store-register [type=checkbox]").change(),"URLSearchParams"in window&&(e=new URLSearchParams(window.location.search).get("yith-pos-edit-register"),i=s(".yith-pos-store-register[data-register-id="+e+"]"),e&&i.length&&(s("#yith-plugin-fw-metabox-tab-edit_store_registers-anchor a").click(),i.find(".yith-pos-settings-box__toggle").click(),setTimeout(function(){yith_pos.scrollTo(i)},200)))}(jQuery);